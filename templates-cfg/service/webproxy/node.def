priority: 917
help: Webproxy service settings


create: sudo /opt/vyatta/sbin/vyatta-update-webproxy.pl --setup;	

end:
     # start/stop vyattaguard
     vg_orig_mode=$(cli-shell-api returnActiveValue service webproxy \
                    url-filtering squidguard vyattaguard mode)

     vg_mode=$(cli-shell-api returnValue service webproxy \
               url-filtering squidguard vyattaguard mode)

     if [ "$vg_orig_mode" != "$vg_mode" ]; then
       if [ -z "$vg_mode" ]; then
         sudo /opt/vyatta/bin/sudo-users/vyatta-vg.pl --stop-vgd
       else
         sudo /opt/vyatta/bin/sudo-users/vyatta-vg.pl --check-cat
         if [ $? != 0 ]; then
            exit 1
         fi
         sudo /opt/vyatta/bin/sudo-users/vyatta-vg.pl --start-vgd
       fi
     fi

     # start/stop squid which in turn kicks off squidguard
     if ! cli-shell-api exists service webproxy; then
         sudo /opt/vyatta/sbin/vyatta-update-webproxy.pl --stop;
     else
         sudo /opt/vyatta/sbin/vyatta-update-webproxy.pl --update;
     fi
